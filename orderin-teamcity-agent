FROM jetbrains/teamcity-agent:latest

ENV DEBIAN_FRONTEND noninteractive

# Install AWS CLI 
RUN apt-get update 
RUN apt-get -y install apt-utils
RUN apt-get -y install python-setuptools 
RUN apt-get -y install python-pip
RUN pip install awscli
RUN apt-get install unzip

# Install GitVersion.Portable
RUN apt-get -y install tzdata
RUN apt-get -y install wget
RUN apt-get -y install mono-complete
RUN apt-get -y install libcurl3
RUN wget https://github.com/GitTools/GitVersion/releases/download/v4.0.0-beta.12/GitVersion_4.0.0-beta0012.zip
RUN unzip GitVersion_4.0.0-beta0012.zip -d GitVersion
RUN cd GitVersion
RUN echo "mono /GitVersion/GitVersion.exe \"\$@\"" >> gitversion
RUN ln -s $(pwd)/gitversion /usr/local/bin/gitversion
RUN chmod 777 $(pwd)/gitversion

# Install Node.js
RUN apt-get -y install nodejs npm

# use npm to update npm.. as lts npm is not latest
RUN npm i npm@latest -g 

# confirm node versions
RUN node -v
RUN npm -v

# Install libpng12 - due to Ubuntu no longer supporting it 
RUN wget -q -O /tmp/libpng12.deb http://mirrors.kernel.org/ubuntu/pool/main/libp/libpng/libpng12-0_1.2.54-1ubuntu1_amd64.deb \ 
 && dpkg -i /tmp/libpng12.deb \ 
 && rm /tmp/libpng12.deb 

# Clean up
RUN rm -rf /tmp/* \
    && apt-get clean

ENV DEBIAN_FRONTEND teletype
