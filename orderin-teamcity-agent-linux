FROM jetbrains/teamcity-agent:latest
ENV DEBIAN_FRONTEND noninteractive

USER root
# Install AWS CLI 

RUN apt-get update --fix-missing
RUN apt-get -y install apt-utils
RUN apt-get -y install python3-setuptools 
RUN apt-get -y install python3-pip
RUN pip3 install awscli
RUN apt-get -y install tzdata
RUN apt-get -y install wget


# Install GitVersion

RUN mkdir GitVersion
RUN wget https://github.com/GitTools/GitVersion/releases/download/5.1.3/gitversion-linux-5.1.3.tar.gz
RUN tar -xvf gitversion-linux-5.1.3.tar.gz -C GitVersion
RUN rm -rf gitversion-linux-5.1.3.tar.gz
RUN echo "/GitVersion/GitVersion \"\$@\"" >> gitversion
RUN ln -s $(pwd)/gitversion /usr/local/bin/gitversion
RUN chmod 777 $(pwd)/gitversion

# Install Node.js

# RUN apt-get -y install nodejs npm
RUN apt-get install curl -y
RUN curl -sL https://deb.nodesource.com/setup_12.x | bash -
RUN apt-get install nodejs

# Install Resharper CLI Tools

RUN mkdir ReSharper
RUN wget https://download.jetbrains.com/resharper/ReSharperUltimate.2019.3/JetBrains.ReSharper.CommandLineTools.Unix.2019.3.tar.gz
RUN tar -xvf /JetBrains.ReSharper.CommandLineTools.Unix.2019.3.tar.gz -C ReSharper
RUN rm -rf JetBrains.ReSharper.CommandLineTools.Unix.2019.3.tar.gz
ENV PATH="/ReSharper/:${PATH}"
RUN ln -s /ReSharper/inspectcode.sh /ReSharper/inspectcode
RUN ln -s /ReSharper/dupfinder.sh /ReSharper/dupfinder

# Install .Net Core 5.0

RUN wget https://download.visualstudio.microsoft.com/download/pr/a2052604-de46-4cd4-8256-9bc222537d32/a798771950904eaf91c0c37c58f516e1/dotnet-sdk-5.0.103-linux-x64.tar.gz  \
&& tar -xvf dotnet-sdk-5.0.103-linux-x64.tar.gz -C /usr/share/dotnet \
        && rm dotnet-sdk-5.0.103-linux-x64.tar.gz \
        && find /usr/share/dotnet -name "*.lzma" -type f -delete 

#Install Kubectl

RUN apt-get install curl -y \
&& curl -LO https://storage.googleapis.com/kubernetes-release/release/`curl -s https://storage.googleapis.com/kubernetes-release/release/stable.txt`/bin/linux/amd64/kubectl \
&& chmod +x ./kubectl \
&& mv ./kubectl /usr/local/bin/kubectl

#Install strong password generator - helps with setting up db users and connection strings

RUN apt-get -y install pwgen

#Install PostgreSQL command line tools

RUN apt-get -y install postgresql

# Install helm and helm-s3 plugin
RUN apt-get -y install openssl 
RUN apt-get -y install git 
RUN curl -L https://raw.githubusercontent.com/helm/helm/master/scripts/get-helm-3 | bash 
RUN helm version 
RUN helm plugin install https://github.com/hypnoglow/helm-s3.git 
RUN helm s3 version --mode 

# Clean up
RUN rm -rf /tmp/* \
    && apt-get clean
ENV DEBIAN_FRONTEND teletype
